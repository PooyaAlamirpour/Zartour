$(window).on("load",function(){function t(){s.domain(u.empty()?c.domain():u.extent()),y.select(".d3-area").attr("d",x),y.select("d3-xaxis").call(f)}function a(t){return t.date=l(t.date),t.price=+t.price,t}function e(){d=r.node().getBoundingClientRect().width-n.left-n.right,b.attr("width",d+n.left+n.right),w.attr("width",d+n.left+n.right),s.range([0,d]),c.range([0,d]),w.selectAll(".d3-xaxis").call(f),w.selectAll(".d3-focus-area").attr("d",x),w.selectAll(".d3-context-area").attr("d",v)}var r=d3.select("#focus-context"),n={top:10,right:10,bottom:100,left:40},i={top:430,right:10,bottom:20,left:40},d=r.node().getBoundingClientRect().width-n.left-n.right,o=500-n.top-n.bottom;height2=500-i.top-i.bottom;var l=d3.time.format("%b %Y").parse,s=d3.time.scale().range([0,d]),c=d3.time.scale().range([0,d]),p=d3.scale.linear().range([o,0]),g=d3.scale.linear().range([height2,0]),f=d3.svg.axis().scale(s).orient("bottom"),h=d3.svg.axis().scale(c).orient("bottom"),m=d3.svg.axis().scale(p).orient("left"),u=d3.svg.brush().x(c).on("brush",t),x=d3.svg.area().interpolate("monotone").x(function(t){return s(t.date)}).y0(o).y1(function(t){return p(t.price)}),v=d3.svg.area().interpolate("monotone").x(function(t){return c(t.date)}).y0(height2).y1(function(t){return g(t.price)}),b=r.append("svg"),w=b.attr("width",d+n.left+n.right).attr("height",o+n.top+n.bottom);w.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",d).attr("height",o);var y=w.append("g").attr("class","focus").attr("transform","translate("+n.left+","+n.top+")"),C=w.append("g").attr("class","context").attr("transform","translate("+i.left+","+i.top+")");d3.csv("../../../app-assets/data/d3/line/focus-context.csv",a,function(t,a){if(t)throw t;s.domain(d3.extent(a.map(function(t){return t.date}))),p.domain([0,d3.max(a.map(function(t){return t.price}))]),c.domain(s.domain()),g.domain(p.domain()),y.append("path").datum(a).attr("class","d3-area d3-focus-area").attr("d",x).style("fill","#5C6BC0"),y.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+o+")").call(f),y.append("g").attr("class","d3-axis d3-yaxis").call(m),C.append("path").datum(a).attr("class","d3-area d3-context-area").attr("d",v).style("fill","#5C6BC0"),C.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+height2+")").call(h),C.append("g").attr("class","d3-xbrush").call(u).selectAll("rect").attr("y",-6).attr("height",height2+7).style("fill-opacity",".225")}),$(window).on("resize",e),$(".menu-toggle").on("click",e)});