$(window).on("load",function(){function t(){n=e.node().getBoundingClientRect().width-a.left-a.right,v.attr("width",n+a.left+a.right),m.attr("width",n+a.left+a.right),s.rangeRoundBands([0,n],.1,0),m.selectAll(".d3-xaxis").call(c),m.selectAll(".d3-bar").attr("x",function(t){return s(t.date)}).attr("width",s.rangeBand())}var e=d3.select("#stacked-to-multiples"),a={top:20,right:20,bottom:30,left:60},n=e.node().getBoundingClientRect().width-a.left-a.right,r=500-a.top-a.bottom,l=d3.time.format("%Y-%m").parse,u=d3.format("02d"),o=function(t){return"Q"+((t.getMonth()/3|0)+1)+u(t.getFullYear()%100)},i=d3.scale.ordinal().rangeRoundBands([r,0],.2),d=d3.scale.linear(),s=d3.scale.ordinal().rangeRoundBands([0,n],.1,0),c=d3.svg.axis().scale(s).orient("bottom").tickFormat(o),f=d3.nest().key(function(t){return t.group}),g=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t.date}).y(function(t){return t.value}).out(function(t,e){t.valueOffset=e}),p=d3.scale.ordinal().range(["#99B898","#FECEA8","#FF847C","#E84A5F"]),v=e.append("svg"),m=v.attr("width",n+a.left+a.right).attr("height",r+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");d3.tsv("../../../app-assets/data/d3/bar/stacked-to-multiples.tsv",function(t,e){function a(){clearTimeout(v),"multiples"===this.value?n():r()}function n(){var t=m.transition().duration(750),e=t.selectAll(".d3-bar-group").attr("transform",function(t){return"translate(0,"+i(t.key)+")"});e.selectAll(".d3-bar").attr("y",function(t){return d(t.value)}),e.select(".d3-group-label").attr("y",function(t){return d(t.values[0].value/2)})}function r(){var t=m.transition().duration(750),e=t.selectAll(".d3-bar-group").attr("transform","translate(0,"+i(i.domain()[0])+")");e.selectAll(".d3-bar").attr("y",function(t){return d(t.value+t.valueOffset)}),e.select(".d3-group-label").attr("y",function(t){return d(t.values[0].value/2+t.values[0].valueOffset)})}if(t)throw t;e.forEach(function(t){t.date=l(t.date),t.value=+t.value});var u=f.entries(e);g(u),s.domain(u[0].values.map(function(t){return t.date})),i.domain(u.map(function(t){return t.key})),d.domain([0,d3.max(e,function(t){return t.value})]).range([i.rangeBand(),0]);var o=m.selectAll(".d3-bar-group").data(u).enter().append("g").attr("class","d3-bar-group").attr("transform",function(t){return"translate(0,"+i(t.key)+")"});o.append("text").attr("class","d3-group-label").attr("x",-60).attr("y",function(t){return d(t.values[0].value/2)}).attr("dy",".35em").text(function(t){return"Group "+t.key}),o.selectAll(".d3-bar").data(function(t){return t.values}).enter().append("rect").attr("class","d3-bar").style("fill",function(t){return p(t.group)}).attr("x",function(t){return s(t.date)}).attr("y",function(t){return d(t.value)}).attr("width",s.rangeBand()).attr("height",function(t){return i.rangeBand()-d(t.value)}),o.filter(function(t,e){return!e}).append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+i.rangeBand()+")").call(c),d3.selectAll(".smradio").on("change",a);var v=setTimeout(function(){d3.select('input[value="stacked"]').property("checked",!0).each(a)},2e3)}),$(window).on("resize",t),$(".menu-toggle").on("click",t)});