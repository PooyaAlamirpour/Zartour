$(window).on("load",function(){function t(t){return t.total=d3.sum(e,function(a){return t[a]=+t[a]}),t}var a=d3.dispatch("load","statechange"),n=d3.select("#disptach-events"),e=["Under 5 Years","5 to 13 Years","14 to 17 Years","18 to 24 Years","25 to 44 Years","45 to 64 Years","65 Years and Over"];d3.csv("../../../app-assets/data/d3/pie/dispatch-events.csv",t,function(t,n){if(t)throw t;var e=d3.map();n.forEach(function(t){e.set(t.id,t)}),a.load(e),a.statechange(e.get("CA"))}),a.on("load.menu",function(t){var e=n.append("div").append("select").on("change",function(){a.statechange(t.get(this.value))});e.selectAll("option").data(t.values()).enter().append("option").attr("value",function(t){return t.id}).text(function(t){return t.id}),a.on("statechange.menu",function(t){e.property("value",t.id)})}),a.on("load.bar",function(t){var e={top:20,right:20,bottom:30,left:40},r=80-e.left-e.right,o=460-e.top-e.bottom,i=d3.scale.linear().domain([0,d3.max(t.values(),function(t){return t.total})]).rangeRound([o,0]).nice(),d=d3.svg.axis().scale(i).orient("left").tickFormat(d3.format(".2s")),s=n.append("svg").attr("width",r+e.left+e.right).attr("height",o+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");s.append("g").attr("class","y axis").call(d);var l=s.append("rect").attr("x",4).attr("width",r-4).attr("y",o).attr("height",0).style("fill","#aaa");a.on("statechange.bar",function(t){l.transition().attr("y",i(t.total)).attr("height",i(0)-i(t.total))})}),a.on("load.pie",function(t){var r=n.node().getBoundingClientRect().width-100,o=460,i=Math.min(r,o)/2,d=d3.scale.ordinal().domain(e).range(["#99B898","#FECEA8","#FF847C","#E84A5F","#F8B195","#F67280","#C06C84"]),s=d3.svg.arc().outerRadius(i-10).innerRadius(i-70),l=d3.layout.pie().sort(null),c=n.append("svg").attr("width",r).attr("height",o).append("g").attr("transform","translate("+r/2+","+o/2+")"),u=c.selectAll("path").data(e).enter().append("path").style("fill",d).each(function(){this._current={startAngle:0,endAngle:0}});a.on("statechange.pie",function(t){u.data(l.value(function(a){return t[a]})(e)).transition().attrTween("d",function(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return s(a(t))}})})})});