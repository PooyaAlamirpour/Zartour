$(window).on("load",function(){function t(e){function l(r){r.children?(r._children=r.children,r.children=null):(r.children=r._children,r._children=null),t(e)}function d(){i=r.node().getBoundingClientRect().width-n.left-n.right,s.attr("width",i+n.left+n.right),u.attr("width",i+n.left+n.right)}var f=x(e);f.forEach(function(t){t.y=180*t.depth+a});var g=u.selectAll("g.node").data(f,function(t){return t.id||(t.id=++o)});f.forEach(function(t){var e=v(t);t.x0=e.x,t.y0=e.y});var w=g.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("click",l);w.append("circle").attr("r",1e-6).style("stroke","#F6BB42").style("stroke-width",1.5).style("cursor","pointer").style("fill",function(t){return t._children?"#F6BB42":"#fff"}),w.append("text").attr("dy",function(t){return t.isRight?18:-12}).attr("text-anchor","middle").text(function(t){return t.name}).style("font-size",12).style("fill-opacity",1e-6);var m=g.transition().duration(c).attr("transform",function(t){return p=v(t),"translate("+p.y+","+p.x+")"});m.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"#F6BB42":"#fff"}),m.select("text").style("fill-opacity",1);var k=g.exit().transition().duration(c).attr("transform",function(t){return p=v(t.parent||e),"translate("+p.y+","+p.x+")"}).remove();k.select("circle").attr("r",1e-6),k.select("text").style("fill-opacity",1e-6);var B=u.selectAll("path.link").data(h.links(f),function(t){return t.target.id});B.enter().insert("path","g").attr("class","link").style("stroke","#F6BB42").style("fill","none").style("stroke-width",1.5).attr("d",function(t){var r={x:e.x0,y:e.y0};return y({source:r,target:r})}),B.transition().duration(c).attr("d",y),B.exit().transition().duration(c).attr("d",function(t){var r=v(t.source||e);return t.source.isRight?r.y-=a-(t.target.y-t.source.y):r.y+=a-(t.target.y-t.source.y),y({source:r,target:r})}).remove(),$(window).on("resize",d),$(".menu-toggle").on("click",d)}var e,r=d3.select("#bracket-tree"),n={top:0,right:0,bottom:0,left:0},i=r.node().getBoundingClientRect().width-n.left-n.right,a=i/2,l=600-n.top-n.bottom-5,o=0,c=500,s=r.append("svg"),u=s.attr("width",i+n.left+n.right).attr("height",l+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),d=function(t){var e=[];if(t.winners)for(var r=0;r<t.winners.length;r++)t.winners[r].isRight=!1,t.winners[r].parent=t,e.push(t.winners[r]);if(t.challengers)for(var r=0;r<t.challengers.length;r++)t.challengers[r].isRight=!0,t.challengers[r].parent=t,e.push(t.challengers[r]);return e.length?e:null},f=d3.behavior.zoom().scaleExtent([1,2]).on("zoom",function(){u.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});s.call(f);var h=d3.layout.tree().size([l,i]),g=(d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),function(t,e){var r=v(t.source),n=v(t.target),i=(n.y-r.y)/2;return t.isRight&&(i=-i),"M"+r.y+","+r.x+"H"+(r.y+i)+"V"+n.x+"H"+n.y}),y=g,v=function(t){var e=t.y;return t.isRight||(e=t.y-a,e=a-e),{x:t.x,y:e}},x=function(t,e){e=e||[];var r=0,n=t.children?t.children.length:0;for(e.push(t);r<n;r++)x(t.children[r],e);return e};d3.json("../../../app-assets/data/d3/tree/bracket-tree.json",function(r){e=r,e.x0=l/2,e.y0=i/2;var n=d3.layout.tree().size([l,a]).children(function(t){return t.winners}),o=d3.layout.tree().size([l,a]).children(function(t){return t.challengers});n.nodes(e),o.nodes(e);var c=function(t){t.children=d(t),t.children&&t.children.forEach(c)};c(e),e.isRight=!1,t(e)})});