$(window).on("load",function(){function t(t){return t.value=+t.value,t}function a(t){t=Math.round(t);var a=t;return Math.abs(t)>1e3&&(a=Math.round(t/1e3)+"K"),"$"+a}function n(){d=e.node().getBoundingClientRect().width-r.left-r.right,u.attr("width",d+r.left+r.right),g.attr("width",d+r.left+r.right),i.rangeRoundBands([0,d],padding),g.selectAll(".d3-xaxis").call(s),g.selectAll(".d3-bar").attr("transform",function(t){return"translate("+i(t.name)+",0)"}),g.selectAll(".d3-bar rect").attr("width",i.rangeBand()),g.selectAll(".d3-bar text").attr("x",i.rangeBand()/2),g.selectAll(".d3-connector").attr("x1",i.rangeBand()+5).attr("x2",i.rangeBand()/(1-padding)-5)}var e=d3.select("#waterfall"),r={top:20,right:20,bottom:30,left:50},d=e.node().getBoundingClientRect().width-r.left-r.right,l=500-r.top-r.bottom;padding=.3;var i=d3.scale.ordinal().rangeRoundBands([0,d],padding),o=d3.scale.linear().range([l,0]),s=d3.svg.axis().scale(i).orient("bottom"),c=d3.svg.axis().scale(o).orient("left").tickFormat(function(t){return a(t)}),u=e.append("svg"),g=u.attr("width",d+r.left+r.right).attr("height",l+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")");d3.csv("../../../app-assets/data/d3/bar/waterfall.csv",t,function(t,n){if(t)throw t;for(var e=0,r=0;r<n.length;r++)n[r].start=e,e+=n[r].value,n[r].end=e,n[r].class=n[r].value>=0?"positive":"negative";n.push({name:"Total",end:e,start:0,class:"total"}),i.domain(n.map(function(t){return t.name})),o.domain([0,d3.max(n,function(t){return t.end})]),g.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+l+")").call(s),g.append("g").attr("class","d3-axis d3-yaxis").call(c);var d=g.selectAll(".d3-bar").data(n).enter().append("g").attr("class",function(t){return"d3-bar "+t.class}).attr("transform",function(t){return"translate("+i(t.name)+",0)"});d.append("rect").attr("y",function(t){return o(Math.max(t.start,t.end))}).attr("height",function(t){return Math.abs(o(t.start)-o(t.end))}).attr("width",i.rangeBand()),d.append("text").attr("x",i.rangeBand()/2).attr("y",function(t){return o(t.end)+5}).attr("dy",function(t){return("negative"==t.class?"-":"")+".75em"}).text(function(t){return a(t.end-t.start)}),d.filter(function(t){return"total"!=t.class}).append("line").attr("class","d3-connector").attr("x1",i.rangeBand()+5).attr("y1",function(t){return o(t.end)}).attr("x2",i.rangeBand()/(1-padding)-5).attr("y2",function(t){return o(t.end)})}),$(window).on("resize",n),$(".menu-toggle").on("click",n)});